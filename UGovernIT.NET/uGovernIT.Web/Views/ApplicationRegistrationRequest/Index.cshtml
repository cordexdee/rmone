@model uGovernIT.Utility.ApplicationRegistrationRequest
@{
    ViewBag.Title = "ApplicationRegistration";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
    var serviceID = ViewBag.ServiceID;
}
    <link rel="stylesheet" type="text/css" href="/Content/click.css" > 
   @* <link rel="stylesheet" type="text/css" href="/Content/bootstrap.min.css" >*@ 
    @*<link rel="stylesheet" type="text/css" href="/Content/font-awesome.min.css" >*@
<style>
    .default {
        fill: rgb(132, 99, 118);
    }
    .in_progress {
        background : rgb(60, 129, 23);
    }
</style>
    <div id="statusLogin" class="applicationRegReq_statusbtn_wrap col-md-12 col-sm-12 col-xs-12">
        <div class="">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12 text-center">
                    <input type="button" id="btnStatus" class="btn applicationRegReq_status_btn" data-toggle="collapse"
                           value="Check Status" data-target="#myDiv" data-open-text="Open" />
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-xs-12 collapse app-status-dv" id="myDiv">
                    @using (Html.BeginForm("RegistrationStatus", "ApplicationRegistrationRequest", FormMethod.Post, new { id = "frmRegistrationStatus", name = "frmRegistrationStatus", role = "form", enctype = "multipart/form-data" }))
                    {
                        <div>
                            <h3 class="applReg_statusTitle "> Application Registration Status</h3>
                        </div>
                        <div class="row">
                            <div class="col-md-12 col-smp-12 col-xs-12">
                                <div class="row">
                                    <div class="col-md-3 col-sm-1 hidden-xs"></div>
                                    <div class="col-md-3 col-sm-5 col-xs-12">
                                        <div class="control-label">
                                            <label class="control-label applRegStatus_inputFeild">
                                                Ticket ID
                                            </label>
                                        </div>
                                        <div class="appReg-inputField">
                                            @Html.TextBoxFor(x => x.TicketID, new { @Value= ViewBag.TicketID, @class = "form-control applReg_satusInputField .style-jk7rq51v" })
                                            @Html.ValidationMessageFor(x => x.TicketID, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-5 col-xs-12">
                                        <div class="control-label">
                                            <label class="control-label applRegStatus_inputFeild">
                                                Email ID
                                            </label>
                                        </div>
                                        <div class="appReg-inputField">
                                            @Html.TextBoxFor(x => x.EmailID, new { @Value = ViewBag.Email, @class = "form-control applReg_satusInputField" })
                                            @Html.ValidationMessageFor(x => x.EmailID, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4"></div>
                                    <div class="col-md-4 applReg_actionBtn_wrap">
                                        <input type="submit" value="Submit" class="btn btn-success btn-sm applicationRegReq_submit_btn" style="font-size:14px; height: 33px; width: 80px;" />
                                        <span class="registrationRequest-loading" style="display:none"><i class=" icon-spinner icon-spin icon-2x"></i></span>
                                        <input type="button" id="Reset" class="btn applicationRegReq_reset_btn" value="Reset" style="font-size:14px; height: 33px; width: 80px;" onclick="resetAll()" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        @*<div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="col-md-3 control-label">
                                    <label class="col-md-3 control-label" style="float: right; font-family:Roboto Condensed; font-size: large; font-weight: normal;">
                                        Ticket ID
                                    </label>
                                </div>
                                <div>
                                    <div class="col-md-6">
                                        @Html.TextBoxFor(x => x.TicketID, new { @class = "form-control .style-jk7rq51v" })
                                        @Html.ValidationMessageFor(x => x.TicketID, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 control-label">
                                    <label class="col-md-3 control-label" style="float: right;font-family:Roboto Condensed; font-size: large; font-weight: normal;">
                                        Email ID
                                    </label>
                                </div>
                                <div>
                                    <div class="col-md-6">
                                        @Html.TextBoxFor(x => x.EmailID, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(x => x.EmailID, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4"></div>
                                <div>
                                    <div class="col-md-4">
                                        <input type="submit" value="Submit" class="btn btn-success btn-sm applicationRegReq_submit_btn" style="font-size:14px; height: 33px; width: 80px;" />
                                        <span class="registrationRequest-loading" style="display:none"><i class=" icon-spinner icon-spin icon-2x"></i></span>
                                        <input type="button" id="Reset" class="btn btn-primary applicationRegReq_reset_btn" value="Reset" style="font-size:14px; height: 33px; width: 80px;" onclick="resetAll()" />
                                    </div>
                                </div>
                            </div>
                        </div>*@
                    }
                </div>
            </div>
        </div>
        </div>
    <div>
        @Html.Partial("RegistrationStatus")
    </div>

    <script>
         $(function () {
             if ($('#TicketID').val() != '' && $('#EmailID').val() != '') {
                 $('#myDiv').show();
             }

             $('#frmRegistrationStatus').ajaxForm({
                 beforeSubmit: function (formData, jqForm, options) {
                     $('.registrationRequest-loading').show();
                     $('input').attr('disabled', 'disabled');
                 },
                 success: function (responseText, statusText, xhr, $form) {
                     $('.registrationRequest-loading').hide();
                     if (typeof responseText != 'object' || responseText.success == 0) {
                         AdminCommon.showMessage(responseText.message, true, 'error', null, { timeOut: 2000 });
                     }
                     else {
                         $('#userTenantInfo').css({ fill: 'rgb(60, 129, 23)' });
                         var data = JSON.parse(responseText.data);
                         var one = {};
                         for (one in data) {
                             if (data[one] === 'in_progress') {
                                 $('#' + one).css({ fill: 'rgb(240,170,48)' });
                                 $('#' + one).siblings('Path').css({ stroke: 'rgb(240,170,48)' });
                             }
                             else if (data[one] === 'completed') {
                                 $('#' + one).css({ fill: 'rgb(60, 129, 23)' });
                                 $('#' + one).siblings('Path').css({ stroke: 'rgb(60, 129, 23)' });
                             }
                         }
                         $('#statusLogin').empty();
                         $('#userTenantInfo, #userTenantInfoImg').attr("onclick", "").unbind("click").attr("class", "");
                         $('#userTenantInfo').css({ fill: 'rgb(60, 129, 23)' });
                     }
                 },
                 error: function (jqXHR, textStatus, errorThrown) {
                     $('.registrationRequest-loading').hide();
                     AdminCommon.showMessage('Error to fetch status', true, 'error', null, { timeOut: 2000 });
                 },
                 complete: function () {
                     $('input').attr('disabled', false);
                     $('select').attr('disabled', false);
                 }
             });
         });
         resetAll = function () {
             $('#frmRegistrationStatus input[type="text"]').val('');
             $('#frmRegistrationStatus select').val("");
             $('.field-validation-error').empty();
         }

         function openTicketDialog(path, params, titleVal, width, height, stopRefresh, returnUrl) {
             //set_cookie('UseManageStateCookies', 'true', null, "<SPContext.Current.Web.ServerRelativeUrl %>");
             window.parent.parent.UgitOpenPopupDialog(path, params, titleVal, width, height, stopRefresh, returnUrl);

         }
         $("[type=button]").button();
         $("[type=button]").click(function () {
             $(this).button('toggle');
             if ($(this).text() === "Closed") {
                 $(this).button('open');
             }
             else {
                 $(this).button('reset');
             }
         });

         $('#userTenantInfoImg, #userTenantInfo').click(function () {
             
             
             window.parent.UgitOpenPopupDialog('/Layouts/uGovernIT/uGovernITConfiguration.aspx?control=ServicesWizard&serviceID=@serviceID&requestPage=SelfRegistration', '', 'Service: Registration of Trial', 90, 90, 0,'%2flayouts%2fugovernit%2fdelegatecontrol.aspx');

         });
         $('#BasicConfigurationImg, #BasicConfiguration').click(function () {
             window.location = "/admin/Index";
         });

    </script>
